<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>100 Dayz - Prototype</title>
    <style>
        body { background-color: #222; color: white; text-align: center; font-family: sans-serif; margin: 0; overflow: hidden; }
        canvas { background-color: #333; border: 2px solid #555; display: block; margin: 20px auto; }
        #ui { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); width: 800px; display: flex; justify-content: space-between; pointer-events: none; }
        .stat { background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px; }
        #controls { margin-top: 10px; font-size: 14px; color: #aaa; }
        #msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 40px; color: red; font-weight: bold; display: none; text-shadow: 2px 2px 2px black; }
        button { pointer-events: auto; cursor: pointer; padding: 5px 10px; background: #d32f2f; color: white; border: none; font-weight: bold; }
        button:hover { background: #b71c1c; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="stat">ğŸ“… Day: <span id="dayCnt">1</span></div>
        <div class="stat">â˜€ï¸ Time: <span id="timeState">ë‚® (íŒŒë°)</span></div>
        <div class="stat">ğŸªµ ìì›: <span id="wood">0</span></div>
        <div class="stat">â¤ï¸ ì²´ë ¥: <span id="hp">100</span></div>
        <div class="stat">âš ï¸ ì§€ì—­ ìœ„í—˜ë„: <span id="threat">1</span> (ì²´ë¥˜ <span id="stayDays">1</span>ì¼ì°¨)</div>
        <button onclick="moveLocation()">ğŸšš ë‹¤ë¥¸ ì§€ì—­ìœ¼ë¡œ ì´ë™ (ìœ„í—˜ë„ ì´ˆê¸°í™”)</button>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="msg">GAME OVER</div>
    
    <div id="controls">
        [W,A,S,D] ì´ë™ | [ë§ˆìš°ìŠ¤ í´ë¦­] ê³µê²©/ì±„ì§‘ | [B] ë°”ë¦¬ì¼€ì´ë“œ ê±´ì„¤ (ìì› 10 ì†Œëª¨) | [M] ì§€ì—­ ì´ë™
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
    let gameActive = true;
    let day = 1;
    let isNight = false;
    let timeTimer = 0;
    const dayDuration = 1000; // ë‚® ì§€ì† ì‹œê°„ (í”„ë ˆì„)
    const nightDuration = 800; // ë°¤ ì§€ì† ì‹œê°„
    
    // í”Œë ˆì´ì–´
    const player = { x: 400, y: 300, size: 20, speed: 4, hp: 100, wood: 0, color: '#4CAF50' };
    
    // ì˜¤ë¸Œì íŠ¸ ë°°ì—´
    let zombies = [];
    let resources = [];
    let barricades = [];
    let bullets = [];

    // í•µì‹¬ ê¸°ë¯¹: ì •ì°© íŒ¨ë„í‹°
    let locationStayDays = 1; // í•œ ê³³ì— ë¨¸ë¬¸ ë‚ ì§œ
    let threatLevel = 1;      // ìœ„í—˜ë„ (ì¢€ë¹„ ìŠ¤í°ìœ¨/ì²´ë ¥ì— ì˜í–¥)

    // ì…ë ¥ ì²˜ë¦¬
    const keys = {};
    const mouse = { x: 0, y: 0 };

    window.addEventListener('keydown', e => {
        keys[e.key] = true;
        if(e.key === 'b' || e.key === 'B') buildBarricade();
        if(e.key === 'm' || e.key === 'M') moveLocation();
    });
    window.addEventListener('keyup', e => keys[e.key] = false);
    window.addEventListener('mousemove', e => {
        const rect = canvas.getBoundingClientRect();
        mouse.x = e.clientX - rect.left;
        mouse.y = e.clientY - rect.top;
    });
    window.addEventListener('mousedown', () => shoot());

    // --- ê²Œì„ ë¡œì§ ---

    function initDay() {
        // ë‚®ì´ ë˜ë©´ ìì› ìƒì„±
        for(let i=0; i<5 + Math.random()*5; i++) {
            resources.push({
                x: Math.random() * (canvas.width - 20),
                y: Math.random() * (canvas.height - 20),
                size: 25,
                hp: 3,
                color: '#8D6E63' // ë‚˜ë¬´ìƒ‰
            });
        }
    }

    // ì§€ì—­ ì´ë™ í•¨ìˆ˜ (ìœ„í—˜ë„ ë¦¬ì…‹)
    window.moveLocation = function() {
        if(!gameActive) return;
        if(isNight) {
            alert("ë°¤ì—ëŠ” ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
            return;
        }
        locationStayDays = 1;
        threatLevel = 1;
        updateUI();
        alert("ìƒˆë¡œìš´ ì§€ì—­ìœ¼ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤. ì•ˆì „í•´ ë³´ì´ì§€ë§Œ ìì›ì„ ë‹¤ì‹œ ëª¨ì•„ì•¼ í•©ë‹ˆë‹¤.");
        // ì´ë™ ì‹œ ë°”ë¦¬ì¼€ì´ë“œ ì´ˆê¸°í™” (ìƒˆ ì§€ì—­ì´ë‹ˆê¹Œ)
        barricades = [];
        // ìì› ì¬ìƒì„±
        resources = [];
        initDay();
    }

    function spawnZombie() {
        // ìœ„í—˜ë„ê°€ ë†’ì„ìˆ˜ë¡ ì¢€ë¹„ê°€ ë” ìì£¼, ë” ê°•í•˜ê²Œ ë‚˜ì˜´
        const spawnRate = Math.max(0.5, 3 - (threatLevel * 0.2)); 
        if (Math.random() * 100 < spawnRate) { 
            // í™”ë©´ ë°–ì—ì„œ ìƒì„±
            let zx, zy;
            if(Math.random() < 0.5) {
                zx = Math.random() < 0.5 ? 0 : canvas.width;
                zy = Math.random() * canvas.height;
            } else {
                zx = Math.random() * canvas.width;
                zy = Math.random() < 0.5 ? 0 : canvas.height;
            }
            
            zombies.push({
                x: zx, y: zy,
                size: 20,
                speed: 1 + (threatLevel * 0.1), // ìœ„í—˜í• ìˆ˜ë¡ ë¹ ë¦„
                hp: 1 + Math.floor(threatLevel / 3), // ìœ„í—˜í• ìˆ˜ë¡ íŠ¼íŠ¼í•¨
                color: '#E53935'
            });
        }
    }

    function buildBarricade() {
        if(player.wood >= 10) {
            player.wood -= 10;
            barricades.push({
                x: player.x,
                y: player.y,
                size: 30,
                hp: 20,
                color: '#FFB74D'
            });
            updateUI();
        }
    }

    function shoot() {
        // ë§ˆìš°ìŠ¤ ë°©í–¥ìœ¼ë¡œ ê³µê²© (ì±„ì§‘ ë˜ëŠ” ê³µê²©)
        // 1. ìì› ì±„ì§‘ ì²´í¬
        let hitResource = false;
        resources.forEach((res, index) => {
            const dist = Math.hypot(res.x - mouse.x, res.y - mouse.y);
            if(dist < res.size + 10 && Math.hypot(player.x - res.x, player.y - res.y) < 60) {
                res.hp--;
                hitResource = true;
                if(res.hp <= 0) {
                    player.wood += 5;
                    resources.splice(index, 1);
                    updateUI();
                }
            }
        });

        // 2. ìì›ì´ ì•„ë‹ˆë©´ ì´ì•Œ ë°œì‚¬
        if(!hitResource) {
            const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
            bullets.push({
                x: player.x, y: player.y,
                vx: Math.cos(angle) * 10,
                vy: Math.sin(angle) * 10,
                size: 5
            });
        }
    }

    function update() {
        if (!gameActive) return;

        // 1. ì‹œê°„ íë¦„ ê´€ë¦¬
        timeTimer++;
        if (!isNight && timeTimer > dayDuration) {
            isNight = true;
            timeTimer = 0;
            updateUI();
        } else if (isNight && timeTimer > nightDuration) {
            isNight = false;
            timeTimer = 0;
            day++;
            locationStayDays++;
            threatLevel = locationStayDays; // ì˜¤ë˜ ë¨¸ë¬¼ë©´ ìœ„í—˜ë„ ì¦ê°€
            zombies = []; // ì•„ì¹¨ì´ ë˜ë©´ ë‚¨ì€ ì¢€ë¹„ ì œê±° (ì„ íƒ ì‚¬í•­)
            initDay();
            updateUI();
        }

        // 2. í”Œë ˆì´ì–´ ì´ë™
        if (keys['w'] || keys['W']) player.y -= player.speed;
        if (keys['s'] || keys['S']) player.y += player.speed;
        if (keys['a'] || keys['A']) player.x -= player.speed;
        if (keys['d'] || keys['D']) player.x += player.speed;
        
        // í™”ë©´ ë°– ì œí•œ
        player.x = Math.max(0, Math.min(canvas.width, player.x));
        player.y = Math.max(0, Math.min(canvas.height, player.y));

        // 3. ì¢€ë¹„ ë¡œì§
        if(isNight) spawnZombie();

        zombies.forEach((z, zIdx) => {
            // í”Œë ˆì´ì–´ ì¶”ì 
            const angle = Math.atan2(player.y - z.y, player.x - z.x);
            z.x += Math.cos(angle) * z.speed;
            z.y += Math.sin(angle) * z.speed;

            // í”Œë ˆì´ì–´ ì¶©ëŒ
            const dist = Math.hypot(player.x - z.x, player.y - z.y);
            if (dist < player.size/2 + z.size/2) {
                player.hp -= 1;
                updateUI();
                if(player.hp <= 0) endGame();
            }

            // ë°”ë¦¬ì¼€ì´ë“œ ì¶©ëŒ
            barricades.forEach((b, bIdx) => {
                const bDist = Math.hypot(b.x - z.x, b.y - z.y);
                if (bDist < b.size/2 + z.size/2) {
                    z.x -= Math.cos(angle) * z.speed; // ë°€ë ¤ë‚¨
                    z.y -= Math.sin(angle) * z.speed;
                    b.hp -= 0.5;
                    if(b.hp <= 0) barricades.splice(bIdx, 1);
                }
            });
        });

        // 4. ì´ì•Œ ì´ë™ ë° ì¶©ëŒ
        bullets.forEach((b, bIdx) => {
            b.x += b.vx;
            b.y += b.vy;

            // í™”ë©´ ë°– ì œê±°
            if(b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
                bullets.splice(bIdx, 1);
                return;
            }

            // ì¢€ë¹„ í”¼ê²©
            zombies.forEach((z, zIdx) => {
                const dist = Math.hypot(b.x - z.x, b.y - z.y);
                if(dist < z.size + b.size) {
                    z.hp--;
                    bullets.splice(bIdx, 1); // ì´ì•Œ ì œê±°
                    if(z.hp <= 0) zombies.splice(zIdx, 1); // ì¢€ë¹„ ì œê±°
                }
            });
        });
    }

    function draw() {
        // ë°°ê²½
        ctx.fillStyle = isNight ? '#1a1a2e' : '#81C784'; // ë°¤/ë‚® ë°°ê²½ìƒ‰ ë³€ê²½
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // ìì›
        resources.forEach(r => {
            ctx.fillStyle = r.color;
            ctx.fillRect(r.x - r.size/2, r.y - r.size/2, r.size, r.size);
            ctx.fillStyle = 'white';
            ctx.fillText("ë‚˜ë¬´", r.x-10, r.y);
        });

        // ë°”ë¦¬ì¼€ì´ë“œ
        barricades.forEach(b => {
            ctx.fillStyle = b.color;
            ctx.fillRect(b.x - b.size/2, b.y - b.size/2, b.size, b.size);
            ctx.strokeStyle = 'black';
            ctx.strokeRect(b.x - b.size/2, b.y - b.size/2, b.size, b.size);
        });

        // í”Œë ˆì´ì–´
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x - player.size/2, player.y - player.size/2, player.size, player.size);
        
        // ì¢€ë¹„
        zombies.forEach(z => {
            ctx.fillStyle = z.color;
            ctx.beginPath();
            ctx.arc(z.x, z.y, z.size/2, 0, Math.PI*2);
            ctx.fill();
        });

        // ì´ì•Œ
        ctx.fillStyle = 'yellow';
        bullets.forEach(b => {
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.size, 0, Math.PI*2);
            ctx.fill();
        });
        
        // ì–´ë‘  íš¨ê³¼ (ë°¤ì—ë§Œ)
        if(isNight) {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
            ctx.fillRect(0,0, canvas.width, canvas.height);
            // í”Œë ˆì´ì–´ ì£¼ë³€ ë°ê²Œ (ì „ì¥ì˜ ì•ˆê°œ íš¨ê³¼ ê°„ì†Œí™”)
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(player.x, player.y, 150, 0, Math.PI*2);
            ctx.fill();
            ctx.globalCompositeOperation = 'source-over';
        }
    }

    function updateUI() {
        document.getElementById('dayCnt').innerText = day;
        document.getElementById('timeState').innerText = isNight ? "ğŸŒ™ ë°¤ (ë°©ì–´!)" : "â˜€ï¸ ë‚® (íŒŒë°)";
        document.getElementById('wood').innerText = player.wood;
        document.getElementById('hp').innerText = Math.floor(player.hp);
        document.getElementById('threat').innerText = threatLevel;
        document.getElementById('stayDays').innerText = locationStayDays;
    }

    function endGame() {
        gameActive = false;
        document.getElementById('msg').style.display = 'block';
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    initDay();
    loop();

</script>
</body>
</html>
